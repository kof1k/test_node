<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - User Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }
        .gradient-bg::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 30s linear infinite;
        }
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .password-strength-bar {
            height: 4px;
            transition: all 0.3s ease;
            border-radius: 2px;
        }
        .strength-weak { background: #ef4444; width: 33%; }
        .strength-medium { background: #f59e0b; width: 66%; }
        .strength-strong { background: #10b981; width: 100%; }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slide-up {
            animation: slideUp 0.5s ease-out;
        }
        .input-group {
            position: relative;
        }
        .input-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            pointer-events: none;
        }
        .input-with-icon {
            padding-left: 2.5rem;
        }
    </style>
</head>
<body class="h-full gradient-bg">
    <div class="min-h-full flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 relative">
        <div class="max-w-2xl w-full space-y-8 glass-effect p-8 rounded-2xl shadow-2xl slide-up">
            <!-- Header -->
            <div class="text-center">
                <div class="mx-auto h-20 w-20 bg-gradient-to-r from-purple-500 to-indigo-600 rounded-full flex items-center justify-center shadow-lg transform hover:scale-110 transition-transform">
                    <i class="fas fa-user-plus text-white text-3xl"></i>
                </div>
                <h2 class="mt-6 text-3xl font-bold text-gray-900">
                    Create Your Account
                </h2>
                <p class="mt-2 text-sm text-gray-600">
                    Join our community and get started today
                </p>
            </div>

            <!-- Progress Steps -->
            <div class="flex items-center justify-center space-x-4">
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-indigo-600 text-white rounded-full flex items-center justify-center text-sm">1</div>
                    <span class="ml-2 text-sm font-medium text-gray-900">Account Info</span>
                </div>
                <div class="w-16 h-0.5 bg-gray-300"></div>
                <div class="flex items-center">
                    <div class="w-8 h-8 bg-gray-300 text-gray-600 rounded-full flex items-center justify-center text-sm">2</div>
                    <span class="ml-2 text-sm text-gray-500">Verify Email</span>
                </div>
            </div>

            <!-- Messages -->
            <% if (errors && errors.length > 0) { %>
                <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded-lg" role="alert">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-triangle text-red-400"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">Please correct the following errors:</h3>
                            <div class="mt-2 text-sm text-red-700">
                                <ul class="list-disc list-inside">
                                    <% errors.forEach(function(error) { %>
                                        <li><%= error.msg || error.message %></li>
                                    <% }); %>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            <% } %>

            <% if (typeof success !== 'undefined' && success) { %>
                <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-lg">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-check-circle text-green-400 text-xl"></i>
                        </div>
                        <div class="ml-3">
                            <p class="text-sm font-medium text-green-800">
                                <%= success %>
                            </p>
                        </div>
                    </div>
                </div>
            <% } %>

            <!-- Registration Form -->
            <form class="mt-8 space-y-6" action="/auth/register" method="POST" id="registrationForm">
                <input type="hidden" name="_csrf" value="<%= typeof csrfToken !== 'undefined' ? csrfToken : '' %>">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- First Name -->
                    <div class="input-group">
                        <label for="firstName" class="block text-sm font-medium text-gray-700 mb-1">
                            First Name <span class="text-gray-400">(Optional)</span>
                        </label>
                        <div class="relative">
                            <i class="fas fa-user input-icon"></i>
                            <input 
                                type="text" 
                                id="firstName" 
                                name="firstName"
                                value="<%= typeof formData !== 'undefined' && formData.firstName ? formData.firstName : '' %>"
                                class="input-with-icon appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                                placeholder="John">
                        </div>
                    </div>

                    <!-- Last Name -->
                    <div class="input-group">
                        <label for="lastName" class="block text-sm font-medium text-gray-700 mb-1">
                            Last Name <span class="text-gray-400">(Optional)</span>
                        </label>
                        <div class="relative">
                            <i class="fas fa-user input-icon"></i>
                            <input 
                                type="text" 
                                id="lastName" 
                                name="lastName"
                                value="<%= typeof formData !== 'undefined' && formData.lastName ? formData.lastName : '' %>"
                                class="input-with-icon appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                                placeholder="Doe">
                        </div>
                    </div>
                </div>

                <!-- Username -->
                <div class="input-group">
                    <label for="username" class="block text-sm font-medium text-gray-700 mb-1">
                        Username <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <i class="fas fa-at input-icon"></i>
                        <input 
                            type="text" 
                            id="username" 
                            name="username"
                            required
                            value="<%= typeof formData !== 'undefined' && formData.username ? formData.username : '' %>"
                            class="input-with-icon appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                            placeholder="johndoe">
                        <span id="usernameCheck" class="absolute right-3 top-1/2 transform -translate-y-1/2 hidden">
                            <i class="fas fa-check-circle text-green-500"></i>
                        </span>
                    </div>
                    <p class="mt-1 text-xs text-gray-500">3-50 characters, letters, numbers, and underscores only</p>
                </div>

                <!-- Email -->
                <div class="input-group">
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">
                        Email Address <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <i class="fas fa-envelope input-icon"></i>
                        <input 
                            type="email" 
                            id="email" 
                            name="email"
                            required
                            value="<%= typeof formData !== 'undefined' && formData.email ? formData.email : '' %>"
                            class="input-with-icon appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                            placeholder="john@example.com">
                        <span id="emailCheck" class="absolute right-3 top-1/2 transform -translate-y-1/2 hidden">
                            <i class="fas fa-check-circle text-green-500"></i>
                        </span>
                    </div>
                    <p class="mt-1 text-xs text-gray-500">We'll send a verification link to this address</p>
                </div>

                <!-- Password -->
                <div class="input-group">
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">
                        Password <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <i class="fas fa-lock input-icon"></i>
                        <input 
                            type="password" 
                            id="password" 
                            name="password"
                            required
                            class="input-with-icon appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                            placeholder="••••••••">
                        <button type="button" onclick="togglePassword('password')" class="absolute right-3 top-1/2 transform -translate-y-1/2">
                            <i class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                        </button>
                    </div>
                    <div class="mt-2">
                        <div class="password-strength-bar" id="passwordStrength"></div>
                        <p class="mt-1 text-xs text-gray-500">
                            <span id="strengthText">Enter a strong password</span>
                        </p>
                    </div>
                    <div class="mt-2 text-xs text-gray-600">
                        <div class="grid grid-cols-2 gap-2">
                            <div id="req-length" class="flex items-center text-gray-400">
                                <i class="fas fa-times-circle mr-1"></i> 8+ characters
                            </div>
                            <div id="req-uppercase" class="flex items-center text-gray-400">
                                <i class="fas fa-times-circle mr-1"></i> Uppercase letter
                            </div>
                            <div id="req-lowercase" class="flex items-center text-gray-400">
                                <i class="fas fa-times-circle mr-1"></i> Lowercase letter
                            </div>
                            <div id="req-special" class="flex items-center text-gray-400">
                                <i class="fas fa-times-circle mr-1"></i> Special character
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Confirm Password -->
                <div class="input-group">
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">
                        Confirm Password <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <i class="fas fa-lock input-icon"></i>
                        <input 
                            type="password" 
                            id="confirmPassword" 
                            name="confirmPassword"
                            required
                            class="input-with-icon appearance-none block w-full px-3 py-2 border border-gray-300 rounded-lg placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all"
                            placeholder="••••••••">
                        <button type="button" onclick="togglePassword('confirmPassword')" class="absolute right-3 top-1/2 transform -translate-y-1/2">
                            <i class="fas fa-eye text-gray-400 hover:text-gray-600"></i>
                        </button>
                    </div>
                    <span id="passwordMatch" class="text-xs hidden mt-1"></span>
                </div>

                <!-- Terms and Conditions -->
                <div class="flex items-start">
                    <input 
                        id="terms" 
                        name="terms" 
                        type="checkbox" 
                        required
                        class="mt-1 h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                    <label for="terms" class="ml-2 block text-sm text-gray-700">
                        I agree to the 
                        <a href="#" class="text-indigo-600 hover:text-indigo-500">Terms and Conditions</a> 
                        and 
                        <a href="#" class="text-indigo-600 hover:text-indigo-500">Privacy Policy</a>
                    </label>
                </div>

                <!-- Submit Button -->
                <div>
                    <button 
                        type="submit" 
                        id="submitBtn"
                        class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transform hover:-translate-y-0.5 transition-all duration-200">
                        <span class="absolute left-0 inset-y-0 flex items-center pl-3">
                            <i class="fas fa-user-plus text-white"></i>
                        </span>
                        Create Account
                    </button>
                </div>

                <!-- Already have account -->
                <div class="text-center">
                    <span class="text-sm text-gray-600">
                        Already have an account?
                        <a href="/auth/login" class="font-medium text-indigo-600 hover:text-indigo-500 transition-colors">
                            Sign in instead
                        </a>
                    </span>
                </div>
            </form>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Password strength checker
        function checkPasswordStrength(password) {
            let strength = 0;
            const strengthBar = document.getElementById('passwordStrength');
            const strengthText = document.getElementById('strengthText');
            
            // Check requirements
            const hasLength = password.length >= 8;
            const hasUppercase = /[A-Z]/.test(password);
            const hasLowercase = /[a-z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const hasSpecial = /[!@#$%^&*]/.test(password);
            
            // Update requirement indicators
            updateRequirement('req-length', hasLength);
            updateRequirement('req-uppercase', hasUppercase);
            updateRequirement('req-lowercase', hasLowercase);
            updateRequirement('req-special', hasSpecial || hasNumber);
            
            // Calculate strength
            if (hasLength) strength++;
            if (hasUppercase) strength++;
            if (hasLowercase) strength++;
            if (hasNumber) strength++;
            if (hasSpecial) strength++;
            
            // Update strength bar
            strengthBar.className = 'password-strength-bar';
            if (password.length === 0) {
                strengthBar.style.width = '0';
                strengthText.textContent = 'Enter a strong password';
                strengthText.className = 'text-gray-500';
            } else if (strength < 3) {
                strengthBar.classList.add('strength-weak');
                strengthText.textContent = 'Weak password';
                strengthText.className = 'text-red-500';
            } else if (strength < 4) {
                strengthBar.classList.add('strength-medium');
                strengthText.textContent = 'Medium strength';
                strengthText.className = 'text-yellow-500';
            } else {
                strengthBar.classList.add('strength-strong');
                strengthText.textContent = 'Strong password';
                strengthText.className = 'text-green-500';
            }
            
            return strength >= 4;
        }
        
        function updateRequirement(id, met) {
            const element = document.getElementById(id);
            if (met) {
                element.classList.remove('text-gray-400');
                element.classList.add('text-green-500');
                element.querySelector('i').classList.remove('fa-times-circle');
                element.querySelector('i').classList.add('fa-check-circle');
            } else {
                element.classList.remove('text-green-500');
                element.classList.add('text-gray-400');
                element.querySelector('i').classList.remove('fa-check-circle');
                element.querySelector('i').classList.add('fa-times-circle');
            }
        }
        
        // Toggle password visibility
        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const icon = field.nextElementSibling.querySelector('i');
            
            if (field.type === 'password') {
                field.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                field.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }
        
        // Check password match
        function checkPasswordMatch() {
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const matchIndicator = document.getElementById('passwordMatch');
            
            if (confirmPassword === '') {
                matchIndicator.classList.add('hidden');
                return false;
            }
            
            matchIndicator.classList.remove('hidden');
            if (password === confirmPassword) {
                matchIndicator.textContent = 'Passwords match';
                matchIndicator.className = 'text-xs text-green-500 mt-1';
                return true;
            } else {
                matchIndicator.textContent = 'Passwords do not match';
                matchIndicator.className = 'text-xs text-red-500 mt-1';
                return false;
            }
        }
        
        // Validate username
        function validateUsername() {
            const username = document.getElementById('username').value;
            const check = document.getElementById('usernameCheck');
            
            if (username.length >= 3 && /^[a-zA-Z0-9_]+$/.test(username)) {
                check.classList.remove('hidden');
                return true;
            } else {
                check.classList.add('hidden');
                return false;
            }
        }
        
        // Validate email
        function validateEmail() {
            const email = document.getElementById('email').value;
            const check = document.getElementById('emailCheck');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            if (emailRegex.test(email)) {
                check.classList.remove('hidden');
                return true;
            } else {
                check.classList.add('hidden');
                return false;
            }
        }
        
        // Event listeners
        document.getElementById('password').addEventListener('input', function() {
            checkPasswordStrength(this.value);
            checkPasswordMatch();
        });
        
        document.getElementById('confirmPassword').addEventListener('input', checkPasswordMatch);
        document.getElementById('username').addEventListener('input', validateUsername);
        document.getElementById('email').addEventListener('input', validateEmail);
        
        // Form submission
        document.getElementById('registrationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const password = document.getElementById('password').value;
            const isStrongPassword = checkPasswordStrength(password);
            const passwordsMatch = checkPasswordMatch();
            const usernameValid = validateUsername();
            const emailValid = validateEmail();
            const termsAccepted = document.getElementById('terms').checked;
            
            if (!isStrongPassword) {
                alert('Please choose a stronger password');
                return;
            }
            
            if (!passwordsMatch) {
                alert('Passwords do not match');
                return;
            }
            
            if (!usernameValid) {
                alert('Please enter a valid username');
                return;
            }
            
            if (!emailValid) {
                alert('Please enter a valid email address');
                return;
            }
            
            if (!termsAccepted) {
                alert('Please accept the terms and conditions');
                return;
            }
            
            // Show loading state
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Creating account...';
            
            // Submit form
            this.submit();
        });
        
        // Auto-hide success messages
        setTimeout(() => {
            const alerts = document.querySelectorAll('[role="alert"]');
            alerts.forEach(alert => {
                if (alert.classList.contains('bg-green-50')) {
                    alert.style.transition = 'opacity 0.5s';
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 500);
                }
            });
        }, 10000);
    </script>
</body>
</html>
